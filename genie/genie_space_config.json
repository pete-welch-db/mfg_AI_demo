{
  "title": "DENSO North America Operations",
  "description": "Manufacturing and supply chain KPIs for the Operations Director. Key KPIs use Unity Catalog metric views (MEASURE). Operating margin, on-time delivery (EV/ADAS), OEE and unplanned downtime, delivery risk, inventory and lead-time reliability.",
  "catalog": "welch",
  "schema": "denso_ai",
  "tables": [
    "welch.denso_ai.mv_plant_oee",
    "welch.denso_ai.mv_on_time_delivery",
    "welch.denso_ai.mv_plant_margin",
    "welch.denso_ai.mv_delivery_risk",
    "welch.denso_ai.gold_inventory_lead_time",
    "welch.denso_ai.gold_capacity_utilization",
    "welch.denso_ai.silver_dim_plant",
    "welch.denso_ai.silver_dim_product",
    "welch.denso_ai.silver_dim_customer",
    "welch.denso_ai.silver_dim_supplier",
    "welch.denso_ai.silver_dim_date"
  ],
  "instructions": "## Role\nYou are assisting the Director of Manufacturing Operations, North America, for an automotive Tier-1 supplier (DENSO). Focus on manufacturing and supply chain KPIs: operating margin (target 9–10%), on-time delivery to OEMs (especially EV and ADAS programs), OEE and unplanned downtime, delivery risk, and inventory/lead-time reliability.\n\n## Key KPIs – use UC metric views and MEASURE()\nFor OEE, on-time delivery, operating margin, and delivery risk always use the Unity Catalog metric views and the MEASURE() function so definitions stay consistent with dashboards and the app.\n\n- **mv_plant_oee** (dimensions: plant_id, work_center_id, product_id, date, week): MEASURE(`OEE %`), MEASURE(`Availability %`), MEASURE(`Downtime min`), MEASURE(`Throughput qty`).\n- **mv_on_time_delivery** (dimensions: plant_id, customer_id, product_family, date): MEASURE(`On-time %`), MEASURE(`Total shipments`), MEASURE(`On-time count`).\n- **mv_plant_margin** (dimensions: plant_id, product_id, customer_id, date): MEASURE(`Margin %`), MEASURE(Revenue), MEASURE(Cost).\n- **mv_delivery_risk** (dimensions: plant_id, customer_id, date): MEASURE(`Avg late probability`), MEASURE(`High-risk count`), MEASURE(`Shipments scored`).\n\nWhen aggregating, use AVG(MEASURE(`...`)) or SUM(MEASURE(...)) as appropriate. Join to dimension tables (silver_dim_plant, silver_dim_customer, silver_dim_product) when you need plant_name, customer_name, program_type, etc.\n\n## Other tables (no metric view)\n- **gold_inventory_lead_time**: avg_lead_time_days, availability_pct, asn_qty, received_qty (no UC metric view).\n- **gold_capacity_utilization**: utilization_pct, capacity_hrs, planned_hrs (no UC metric view).\n- **Dimensions:** silver_dim_plant (plant_name, region), silver_dim_product (product_name, product_family, program_type: EV/ADAS/Other), silver_dim_customer (customer_name, program_name), silver_dim_supplier, silver_dim_date.\n\n## Time filters\nUse the `date` column for time filters. Default to last 90 days for \"current\" unless the user specifies otherwise.\n\n## SQL formatting\nPercentages: CONCAT(ROUND(value, 1), '%') or show as decimal 0–100. Currency: FORMAT_NUMBER(value, '$#,##0.00') where applicable.",
  "sample_queries": [
    {"question": "What is our current operating margin by plant in North America?", "sql": "SELECT p.plant_id, p.plant_name, p.region, AVG(MEASURE(`Margin %`)) AS avg_margin_pct FROM welch.denso_ai.mv_plant_margin g JOIN welch.denso_ai.silver_dim_plant p ON g.plant_id = p.plant_id WHERE g.date >= date_sub(current_date(), 90) GROUP BY p.plant_id, p.plant_name, p.region ORDER BY avg_margin_pct"},
    {"question": "Which customer programs have the lowest margin this quarter?", "sql": "SELECT c.customer_id, c.program_name, AVG(MEASURE(`Margin %`)) AS avg_margin_pct FROM welch.denso_ai.mv_plant_margin g JOIN welch.denso_ai.silver_dim_customer c ON g.customer_id = c.customer_id WHERE g.date >= date_trunc('quarter', current_date())::date GROUP BY c.customer_id, c.program_name ORDER BY avg_margin_pct ASC LIMIT 10"},
    {"question": "What is our on-time delivery rate for EV programs this month?", "sql": "SELECT AVG(MEASURE(`On-time %`)) AS on_time_pct FROM welch.denso_ai.mv_on_time_delivery g JOIN welch.denso_ai.silver_dim_customer c ON g.customer_id = c.customer_id WHERE g.date >= date_trunc('month', current_date())::date AND c.program_name LIKE '%EV%'"},
    {"question": "Which plants are missing delivery targets?", "sql": "SELECT g.plant_id, p.plant_name, AVG(MEASURE(`On-time %`)) AS on_time_pct FROM welch.denso_ai.mv_on_time_delivery g JOIN welch.denso_ai.silver_dim_plant p ON g.plant_id = p.plant_id WHERE g.date >= date_sub(current_date(), 30) GROUP BY g.plant_id, p.plant_name HAVING AVG(MEASURE(`On-time %`)) < 95 ORDER BY on_time_pct"},
    {"question": "Show on-time delivery trend by OEM for the last 6 months", "sql": "SELECT c.customer_name, date_trunc('month', g.date) AS month, AVG(MEASURE(`On-time %`)) AS on_time_pct FROM welch.denso_ai.mv_on_time_delivery g JOIN welch.denso_ai.silver_dim_customer c ON g.customer_id = c.customer_id WHERE g.date >= date_sub(current_date(), 180) GROUP BY c.customer_name, date_trunc('month', g.date) ORDER BY c.customer_name, month"},
    {"question": "Which plants have the lowest OEE?", "sql": "SELECT g.plant_id, p.plant_name, AVG(MEASURE(`OEE %`)) AS avg_oee_pct, SUM(MEASURE(`Downtime min`)) AS total_downtime_min FROM welch.denso_ai.mv_plant_oee g JOIN welch.denso_ai.silver_dim_plant p ON g.plant_id = p.plant_id WHERE g.date >= date_sub(current_date(), 30) GROUP BY g.plant_id, p.plant_name ORDER BY avg_oee_pct LIMIT 10"},
    {"question": "Where do we have the most unplanned downtime?", "sql": "SELECT g.plant_id, g.work_center_id, p.plant_name, SUM(MEASURE(`Downtime min`)) AS downtime_min FROM welch.denso_ai.mv_plant_oee g JOIN welch.denso_ai.silver_dim_plant p ON g.plant_id = p.plant_id WHERE g.date >= date_sub(current_date(), 30) GROUP BY g.plant_id, g.work_center_id, p.plant_name ORDER BY downtime_min DESC LIMIT 10"},
    {"question": "What is our average delivery risk (late probability) by plant?", "sql": "SELECT g.plant_id, p.plant_name, AVG(MEASURE(`Avg late probability`)) AS avg_late_prob FROM welch.denso_ai.mv_delivery_risk g JOIN welch.denso_ai.silver_dim_plant p ON g.plant_id = p.plant_id WHERE g.date >= date_sub(current_date(), 30) GROUP BY g.plant_id, p.plant_name ORDER BY avg_late_prob DESC"},
    {"question": "What is our inventory turn rate by plant?", "sql": "SELECT g.plant_id, p.plant_name, SUM(g.received_qty) AS received_qty, AVG(g.avg_lead_time_days) AS avg_lead_time_days FROM welch.denso_ai.gold_inventory_lead_time g JOIN welch.denso_ai.silver_dim_plant p ON g.plant_id = p.plant_id WHERE g.date >= date_sub(current_date(), 90) GROUP BY g.plant_id, p.plant_name ORDER BY received_qty DESC"},
    {"question": "Which suppliers have the worst lead-time reliability?", "sql": "SELECT g.supplier_id, s.supplier_name, AVG(g.avg_lead_time_days) AS avg_lead_days, AVG(g.availability_pct) AS availability_pct FROM welch.denso_ai.gold_inventory_lead_time g JOIN welch.denso_ai.silver_dim_supplier s ON g.supplier_id = s.supplier_id WHERE g.date >= date_sub(current_date(), 90) GROUP BY g.supplier_id, s.supplier_name ORDER BY availability_pct, avg_lead_days DESC LIMIT 10"},
    {"question": "How does margin for EV programs compare to ADAS?", "sql": "SELECT pr.program_type, AVG(MEASURE(`Margin %`)) AS avg_margin_pct FROM welch.denso_ai.mv_plant_margin g JOIN welch.denso_ai.silver_dim_product pr ON g.product_id = pr.product_id WHERE g.date >= date_sub(current_date(), 90) AND pr.program_type IN ('EV', 'ADAS') GROUP BY pr.program_type ORDER BY avg_margin_pct"}
  ]
}
